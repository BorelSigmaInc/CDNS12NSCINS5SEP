<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply: Fusion Systems Engineer | Zi-US Research</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500&display=swap');
        :root {
            --primary: #000000; --secondary: #1a1a1a; --accent: #0066ff;
            --gray-100: #f8f9fa; --gray-200: #e9ecef; --gray-600: #6c757d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 62.5%; }
        body { font-family: 'Calibri Light', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; font-weight: 300; font-size: 1.4rem; line-height: 1.6; color: var(--primary); background: var(--gray-100); }
        nav { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border-bottom: 1px solid var(--gray-200); padding: 1.2rem 0; }
        .nav-container { display: flex; align-items: center; justify-content: space-between; max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        .brand-name { font-size: 1.4rem; font-weight: 400; letter-spacing: 0.05em; text-decoration: none; color: var(--primary); }
        .container { max-width: 800px; margin: 6rem auto; padding: 0 2rem; }
        .application-card { background: white; border: 1px solid var(--gray-200); padding: 3rem; }
        .form-header h1 { font-size: 2.8rem; font-weight: 300; margin-bottom: 0.8rem; }
        .form-header p { font-size: 1.3rem; color: var(--gray-600); margin-bottom: 3rem; }
        .form-group { margin-bottom: 2rem; }
        .form-group label { display: block; font-size: 1.1rem; font-weight: 400; margin-bottom: 0.8rem; }
        .form-input { width: 100%; padding: 1.2rem; font-size: 1.2rem; border: 1px solid var(--gray-200); background: var(--gray-100); }
        .btn { display: block; width: 100%; padding: 1.2rem; font-size: 1.2rem; font-weight: 400; text-align: center; cursor: pointer; transition: all 0.2s ease; border: 1px solid var(--primary); background: var(--primary); color: white; }
        .btn:disabled { background: var(--gray-600); border-color: var(--gray-600); cursor: not-allowed; }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="brand-name">Zi-US Research</a>
            <a href="career.html" style="font-size: 1.1rem; text-decoration: none; color: var(--primary);">‚Üê Back to Careers</a>
        </div>
    </nav>
    <div class="container">
        <div id="application-card" class="application-card">
            <div class="form-header">
                <h1>Application for Fusion Systems Engineer</h1>
                <p>Please complete the form below. You will be redirected to sign in to securely submit your application.</p>
            </div>
            <form id="application-form">
                <div class="form-group"><label for="fullName">Full Name</label><input type="text" id="fullName" class="form-input" required></div>
                <div class="form-group"><label for="email">Email Address</label><input type="email" id="email" class="form-input" required></div>
                <div class="form-group"><label for="phone">Phone Number</label><input type="tel" id="phone" class="form-input"></div>
                <div class="form-group"><label for="cv">Upload CV (PDF, DOCX)</label><input type="file" id="cv" class="form-input" accept=".pdf,.doc,.docx" required></div>
                <div class="form-group"><label for="research">Upload Research Work (Optional, PDF)</label><input type="file" id="research" class="form-input" accept=".pdf"></div>
                <button type="submit" id="submit-btn" class="btn">Save and Continue to Sign In</button>
            </form>
        </div>
    </div>

    <script>
        const jobTitle = "Fusion Systems Engineer";
        const form = document.getElementById('application-form');
        const submitBtn = document.getElementById('submit-btn');

        // Helper function to read a file as a Data URL
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';

            const cvFile = document.getElementById('cv').files[0];
            const researchFile = document.getElementById('research').files[0];

            if (!cvFile) {
                alert('CV is required.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save and Continue to Sign In';
                return;
            }

            try {
                const cvDataUrl = await readFileAsDataURL(cvFile);
                const researchDataUrl = researchFile ? await readFileAsDataURL(researchFile) : null;

                const applicationData = {
                    jobTitle: jobTitle,
                    fullName: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    cvName: cvFile.name,
                    researchName: researchFile ? researchFile.name : null,
                    cvDataUrl: cvDataUrl,
                    researchDataUrl: researchDataUrl,
                };

                // Save data to sessionStorage
                sessionStorage.setItem('pendingApplication', JSON.stringify(applicationData));

                // Redirect to the sign-in page
                window.location.href = 'signin.html';

            } catch (error) {
                console.error("Error processing files:", error);
                alert("There was an error processing your files. Please try again.");
                submitBtn.disabled = false;
                submitBtn.textContent = 'Save and Continue to Sign In';
            }
        });
    </script>
</body>
</html>
